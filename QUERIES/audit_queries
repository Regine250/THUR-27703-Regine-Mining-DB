CREATE TABLE insert_audit (
    audit_id    NUMBER GENERATED BY DEFAULT AS IDENTITY,
    table_name  VARCHAR2(30),
    attempted_on DATE,
    attempted_by VARCHAR2(30),
    allowed      VARCHAR2(10),
    reason       VARCHAR2(200)
);

SELECT audit_id,
       table_name,
       attempted_on,
       attempted_by,
       allowed,
       reason
FROM insert_audit
ORDER BY audit_id DESC;


--EQUIPMENT_AUDIT

CREATE TABLE equipment_audit (
    audit_id NUMBER GENERATED BY DEFAULT AS IDENTITY,
    equipment_id NUMBER,
    old_status VARCHAR2(20),
    new_status VARCHAR2(20),
    changed_on DATE
);

-- TRIGGER

CREATE OR REPLACE TRIGGER audit_equipment_status
AFTER UPDATE OF status ON equipment
FOR EACH ROW
WHEN (OLD.status <> NEW.status)
BEGIN
    INSERT INTO equipment_audit (
        equipment_id, old_status, new_status, changed_on
    ) VALUES (
        :OLD.equipment_id,
        :OLD.status,
        :NEW.status,
        SYSDATE
    );
END;
/
